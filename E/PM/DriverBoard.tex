\documentclass[a4paper,12pt]{article}
%\documentclass[letterpaper,12pt]{report}

\usepackage{ucs}
\usepackage[utf8x]{inputenc}
\usepackage[english]{babel}
\usepackage{fontenc}
\usepackage{graphicx}
\usepackage[hmargin=2cm,vmargin=2.5cm]{geometry}

% Space out paragraphs, don't indent
 \setlength{\parindent}{0.0in}
 \setlength{\parskip}{0.1in}



\usepackage[dvips]{hyperref}

\author{John P. Doty}
\date{\today}
\title{SXI Driver Board Design}

\begin{document}
\begin{titlepage}
\maketitle
\end{titlepage} 

\section{INTRODUCTION}
This document describes the circuits on the driver board for the Soft X-ray Imager under development for the ASTRO-H high energy astronomy mission.

This version of the design is intended for resource estimation and preliminary review. This document will evolve as the design evolves.

In the SXI focal plane, there will be four Hamamatsu CCD-PchNeXT4 sensor chips. Each chip will have its own driver board. 

Horizontal clock rate is assumed to be 132 kHz. Vertical clock rate is assumed to be 32 kHz. Available regulated voltages will be +15V, -15V, and +3.3V. 

%These parameters were established after many of these circuits were first drawn, so they should be checked, particularly for adequate voltage breakdown margin.

\subsection{Requirements}
The next two tables derive primarily from the CCD-PchNeXT4 specsheet. Required voltage precision is based on previous CCD experience. The last column identifies the circuit that must meet the requirement, for reference.

\begin{tabular}{|l|rrrr|rrrr|r|l|}
\hline
&\multicolumn{4}{c|}{Low(V)}&\multicolumn{4}{c|}{High(V)}& C(pF)& Driver Circuit \\ 
&Min.&Typ.&Max.&Prec.&Min.&Typ.&Max&Prec.&& \\
\hline
RG & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 70 & Serial-driver \\
SG & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
TG & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 180 & Serial-driver \\
P1VI & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 100000 & Parallel \\
P2VI & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 100000 & Parallel \\
P1VS & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 60000 & Parallel \\
P2VS & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 60000 & Parallel \\
PXH & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 320 & Serial-driver \\
PXH/ & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 320 & Serial-driver \\
PYH & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
PYH/ & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
PZH & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
PZH/ & -8 & -7 & -6 & 0.1 & +2 & +3 & +4 & 0.1 & 160 & Serial-driver \\
IG1V & -15? & ? & +15? & 0.01? & -15? & ? & +15? & 0.01? & 230 & Serial-driver \\
IG2V & -15? & ? & +15? & 0.01? & -15? & ? & +15? & 0.01? & 230 & Serial-driver \\
ISV & -18? & ? & +0.5? & 0.01? & -18? & ? & +0.5? & 0.01? & ? & Serial-driver \\
\hline
\end{tabular}

\begin{tabular}{|l|rrrr|r|l|}
\hline
&\multicolumn{4}{c|}{Bias(V)} &mA&Driver Circuit \\
&Min.& Typ.& Max.&Prec& Max.&\\
\hline
OD-A &-22 &-20& -18& 0.1&1.2&OD-driver \\
OD-B &-22 &-20& -18& 0.1&1.2&OD-driver \\
OD-C &-22 &-20& -18& 0.1&1.2&OD-driver \\
OD-D &-22 &-20& -18& 0.1&1.2&OD-driver \\
RD &-13& -12 &-11& 0.1&0.001&DC-driver \\
OG& -7& -5& -3&  0.1&0.001&OG \\
BB &+20 &+30 &+40 &0.5&0.001&BB \\
\hline
\end{tabular}

% Experience suggests that a clock driver time constant of 1/10 the clock period  is sufficiently small. 

%The heaviest loads for the Serial-driver block are P1H and P3H, with 12\ V max swings into 320\ pF at 132\ kHz. Output resistance of $<$2.3\ k$\Omega$ and peak current capability of $>$30\ mA will achieve  the required time constant of $<$750\ ns. IG1V and IG2V have larger swings, but they synchronize with the slower vertical clocks, so they need no more peak current.

%The heaviest loads on the Parallel block are the Vertical imaging area clocks, with 12\ V max swings into 100\ nF 


%I've pulled these together from a variety of documents: they need verification. The clock requirements  %are much less challenging than I assumed when I designed these blocks.

%Vertical clock voltages: (+2,-6) nominal, high level adjustable (0 to +10), low level adjustable (-10 to 0).

%Two vertical phases, two sections (imaging and storage). Total vertical clock capacitance 20nF. Clock rate 32 kHz. Nominal clock current, derived from the numbers above, is 5 mA.
%Horizontal clock voltages:  (+6,-5) nominal, high level adjustable (0 to +10), low level adjustable (-10 to 0).

%Three horizontal phases, four sections. Total horizontal clock capacitance 1.28nF. Clock rate 136 kHz. Nominal clock current, derived from the numbers above, is 2 mA.

%Four output drains, operating range -18V to -22V, 1.2mA nominal each. Absolute maximum voltage -25V. Independently adjustable.

%Output gate voltage range -10V to 0, nominal -5.

%Drivers should have capacity of at least twice nominal current.

%ISV, ID: what are current requirements?



\section{Building Block Details}
\subsection{REF}
   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{REF.pdf}
   \end{tabular}
   \end{center}
   \end{figure}

The REF block provides a 2.5V reference voltage for the DAC and driver circuits. The REF43 has flown successfully on a number of missions, including Suzaku. 2.5V seems a good choice for a reference in a system whose low voltage supply is 3.3V. The capacitors implement the recommended bypassing for the REF43.
R1 provides current limiting and decoupling.

% Issues:
% \begin{enumerate}
% \item
% Is there a preferred part for this other than the REF196?
% \item
% There is no current limit on VL. Should there be one here, or should it be handled at a higher level?
% \end{enumerate}

\subsection{DAC}
% Needed: 2? per CCD, 8? per SXI
%Two blocks gives us 16 DAC's, enough for (OD*4,RD,RG+-,OG,BB,H+-,V+-,IG+-,ISV). Is that enough, 
% or do we need three?
   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{DAC.pdf}
   \end{tabular}
   \end{center}
   \end{figure}
The AD5308 DAC chip provides a buffered output from 0V to (255/256) of the reference voltage. R1 provides decoupling and current limiting in case of latchup.

Issues:
\begin{enumerate}
\item
CMOS DAC chips tend to be sensitive to radiation dose. The radiation environment for ASTRO-H is not severe, so I do not expect a problem. However, I have no radiation data on this device, so I have a small concern.
\end{enumerate}

\subsection{BBOG}

   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{BBOG.pdf}
   \end{tabular}
   \end{center}
   \end{figure}
%Needed: 1 per CCD, 4 per SXI
Half of U1 and its associated components form the driver for the output gate (OG) electrodes. These require almost no current, only leakage, but they are adjacent to the charge sense nodes, so they are sensitive to noise. The filter formed by R6 and C6 is intended to strongly attenuate noise at the video frequency. However, this filter potentially destabilizes the driver circuit: C3 provides phase-advanced feedback to stabilize the circuit. If the feedback time constant $R5\times C3$ is four times the output time constant $R6\times C6$, the circuit is critically damped, assuming that this time constant is also large compared to the amplifier's unity gain small signal response time. This approach to noise reduction and stabilization is employed in several other driver blocks below.

Minimum output voltage is $-2.5\times(R5/R7)$ or $-7.5V$ when the DACOG DAC is set to zero. Maximum is $2.5V$ when DACOG is set to $255$.

U2 switches between $Vp$ and $Vm$ $(\pm15V)$, creating 30V square-wave drive for a charge pump. The switching frequency, applied to PCLK, should be at the pixel rate to minimize the effect of crosstalk and ripple on the video signal. D1, D2, and their associated capacitors form a two stage charge pump, nominally capable of 60V output if losses are ignored. C4 is intentionally fairly small to limit current at startup and under fault conditions. $1nF\times30V\times132kHz=4mA$ into the pump under short circuit conditions. That's 2mA into the pump output.
% , although there is little quantitative reasoning behind this specific value. 
The other capacitors in the pump (C1, C2, C5) are larger to minimize ripple and loss.

Q1 and Q2 are high voltage transistors making a voltage translation amplifier with gain of about 3.7 (set by $R11/R10$)and an offset roughly equal to the pump output voltage. Applying a negative voltage to R10 thus reduces the output voltage (BB). Half of U1 provides this negative drive. R9 and R10 set the gain at 16, so the maximum output voltage is 40V. The output time constant is $R12\times C10$, or about 1 ms. In this case, the damping effect of C11 is reduced by the gain of the voltage translation stage, so for critical damping the $R9\times C11$ time constant should be $(3.7\times4)$ or 15ms. As drawn, it's 16 ms, for a little overdamping. With the output of U1 at the negative rail, the output is nominally $60V-3.7\times15V$ or about 4.5V, ignoring losses and diode drops. That's well below the required minimum of 20V.

43V precision Zener diode D3 limits the output voltage to below the absolute maximum of 45V.

The load current on BB is $<1\mu A$. The voltage regulator pulls $60\mu A$ from the pump, much less than the 2mA limit.

R1, R2, and R3 limit current to U2, protecting it in case of latchup. R13 and R14 limit current to U1, although that's less of a concern: U1 is not CMOS so it should be more resistant to latchup. These resistors also help decouple chip power from power supply noise and ripple.

Output filter capacitors have separate return connections here so that they may be connected for best EMI performance at the higher level.

%Issues:%\begin{enumerate}%\item%OG output range doesn't match requirement.%\item%C6 shown returned to board ground. This may not be the best from a noise perspective. Signal return topology requires some thought.%\item%With $\pm15V$ supplies now specified, R10 could be increased to 330k, reducing the translation gain and improving the damping.%\end{enumerate}%
\subsection{DACtoClock}

   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{DACtoClock.pdf}
   \end{tabular}
   \end{center}
   \end{figure}

%Needed: 4? per CCD, 16? per SXI
%Translates DAC voltages to clock voltages. I assume we need:
%Reset Gate
%Horizontal
%Vertical
%Input Gate
%But there are questions:
%I assume voltages for VI==VS==TG. Is this true?
%I assume voltages for horizantal==SG. Is this true?
%I assume charge injection voltages for IG1==IG2. Is this true?

This is a pair of amplifiers with gains of $\pm3$ yielding outputs of 0 to 9.9V and -9.9V to 0 for drivers. Noise filtering and damping are similar to the blocks above.

Issues:
\begin{enumerate}
\item
Drive from the OP220 opamp specified is only $\pm1 mA$. This is inadequate for the parallel regulators, and serial clocks. Either a higher current opamp should be selected, or a current boost amplifier should be added. We may also want to reduce the current drive required by the parallel regulators.
\end{enumerate}

Issues:
\begin{enumerate}
\item
C6 shown returned to board ground. This may not be the best from a noise perspective. Signal return topology requires some thought.
\end{enumerate}



\subsection{DC-driver}
   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{DC-driver.pdf}
   \end{tabular}
   \end{center}
   \end{figure}

This provides low current drive for ID and ISV. Gain is -4.55, so at DAC full scale, the output will be -15V nominally, although it may saturate at a slightly higher voltage, depending on the voltage of the -15V supply.

%Needed: 1 per CCD, 4 per SXI
%Drives ID and ISV.

Issues:
\begin{enumerate}
\item
This circuit is really just a placeholder: what are the requirements?
\end{enumerate}


\subsection{OD-driver}
   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{OD-driver.pdf}
   \end{tabular}
   \end{center}
   \end{figure}

This provides drive for two output drains. Full scale on the DAC corresponds to -24V on the output. The transistors boost the opamp output current.

%Needed: 2 per CCD, 8 per SXI
%Drives OD for each output.

Issues:
\begin{enumerate}
\item
C2 and C4 shown returned to board ground. This may not be the best from a noise perspective. Signal return topology requires some thought.
\end{enumerate}


\subsection{ParallelReg}
   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{ParallelReg.pdf}
   \end{tabular}
   \end{center}
   \end{figure}

These are overload-protected high current regulators intended for high speed clocking of a high capacitance CCD. They can handle high power safely, but they don't match the required voltage range when driven by the DACtoClock block (and the DACtoClock block can't drive their input current), and are inefficient. Their high power capability is not required.

Issues:
\begin{enumerate}
\item
This block needs redesign. It is inefficient does not match our present requirements.
\end{enumerate}


%Needed: 1? per CCD, 4? per SXI
%Regulates vertical clock voltages. VI==VS?

\subsection{ParallelPair}

   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{ParallelPair.pdf}
   \end{tabular}
   \end{center}
   \end{figure}

This is a high current driver intended for high speed clocking of a high capacitance CCD. 

Issues:
\begin{enumerate}
\item
For our present requirements, this block is unneeded. The SerialDrivers block has sufficient drive capability.
\end{enumerate}

%Needed: 2 per CCD, 8 per SXI
%Drives P(1,2)(VI,VS)

\subsection{SerialDrivers}
   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{SerialDrivers.pdf}
   \end{tabular}
   \end{center}
   \end{figure}
   
This is just a pair of analog switches, intended to drive a low capacitance clock. The resistors limit fault currents due to latchup or output short circuits.

Issues:
\begin{enumerate}
\item
The limiting resistors may be increased for greater protection because the drive requirements are reduced.
\end{enumerate}

%Needed: 4? per CCD, 16? per SXI
%Drives RG, SG, P1H, P3H, IG1V, IG2V, TG. Is this the right list?

\subsection{OD-pump}

   \begin{figure}
   \begin{center}
   \begin{tabular}{c}
   \includegraphics[height=17cm,angle=90,keepaspectratio=true]{OD-pump.pdf}
   \end{tabular}
   \end{center}
   \end{figure}
   
This charge pump provides -30V (nominal assuming no losses). It is a single stage design, pumping negative charge from a 15V square wave signal using the -15V supply as its "ground". It is intended to be able to drive at least 10 mA. Q3, Q4, and their associated resistors form a current limiter to protect against an output short circuit. R4 and R5 protect U1 against latchup.

\section{Connecting the Blocks}

Coming soon!

\section{Status}

The clock drivers don't match present requirements and the blocks won't quite work together. Fortunately, the combination of an enhanced DACtoClock block and a slightly revised SerialDrivers block appears to meet requirements and consume less power than the present design.

Present requirements are not complete.

Much review required. Power dissipation and resistance of protection resistors needs particular attention.

\end{document}
